# 第二章-文件IO

内核为每个进程维护一个打开的文件列表(file table), 该表由文件描述符索引. 子进程会获得一份父进程的文件表拷贝.

## 打开文件

### 文件权限

open()创建文件分配权限原理:

1. umask掩码取反
2. 函数中mode参数与取反后的掩码相与

默认权限:

* 目录: 掩码与777位异或
* 文件: 掩码与777位异或, 再去掉执行权限. (创建文件时不分配执行权限, chmod后期修改)

## 读取文件

### read()返回值

函数声明: ssize_t read(int fd, void* buf, size_t count)

* ret == count
* ret == -1

  可恢复的读取: 函数执行出错返回-1, 并设置errno为EINTR

* ret == 0

  EOF, 读到了文件末尾

* 0 < ret < count

  1) 可供读取的字节数小于count
  2) 系统调用被信号打断
  3) 管道被破坏
  4) 等等
